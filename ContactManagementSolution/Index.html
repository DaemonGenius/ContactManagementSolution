<!DOCTYPE html>
<html>
<head>
    <link href="Content/bootstrap.min.css"
          rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <script>

        $(document).ready(function () {
            contactDetailsList();
        });
        // Handle click event on Update button
        function updateClick() {
        }
        // Handle click event on Add button
        function addClick() {
        }

        function contactDetailsList() {
            // Call Web API to get a list of Product
            $.ajax({
                url: '/api/ContactDetails/GetAll',
                type: 'GET',
                dataType: 'json',
                success: function (ContactDetails) {
                    contactListSuccess(ContactDetails);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function contactListSuccess(ContactDetails) {
            // Iterate over the collection of data
            $.each(ContactDetails, function (index, contact) {
                // Add a row to the Product table
                contactAddRow(contact);
            });
        }

        function contactAddRow(contacts) {
            // Check if <tbody> tag exists, add one if not
            if ($("#ContactTable tbody").length == 0) {
                $("#ContactTable").append("<tbody></tbody>");

            }
            // Append row to <table>
            $("#ContactTable tbody").append(
                contactBuildTableRow(contacts));
        }

        function contactBuildTableRow(contact) {
            var ret =
              
                "<tr>" +
                "<td>" +
                "<button type='button' " +
                "onclick='contactGet(this);' " +
                "class='btn btn-default' " +
                "data-id='" + contact.ID + "'>" +
                "<span class='glyphicon glyphicon-pencil' />"
                + "</button>" +
                "</td >" +
                "<td>" + contact.FName + "</td>" +
                "<td>" + contact.LName + "</td>"
                + "<td>" + contact.PhoneNumber + "</td>" +
                "</tr>";
            return ret;
        }

        function handleException(request, message,
            error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
            alert(msg);
        }
        function addClick() {            
            Contact = new Object();
           
            Contact.FName = $("#fname").val();
            Contact.LName = $("#lName").val();
            Contact.PhoneNumber = $("#cNum").val();
         
            if ($("#updateButton").text().trim() ==
                "Add") {
                ContactAdd(Contact);
                formClear();
            } else if ($("#updateButton").text().trim() ==
                "Update") {
                Contact.ID = $("#contactId").val();
                contactUpdate(Contact);
                formClear();
            }
        }

        function ContactAdd(Contact) {       
            $.ajax({
                url: "/api/ContactDetails/PostNewContact",
                type: 'POST',
                contentType:"application/json;charset=utf-8",
                data: JSON.stringify(Contact),
                success: function (Contact) {
                    contactAddSuccess(Contact);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function contactUpdate(Contact) {
            $.ajax({
                url: "/api/ContactDetails/Update",
                type: 'PUT',
                contentType:
                "application/json;charset=utf-8",
                data: JSON.stringify(Contact),
                success: function (Contact) {
                    contactUpdateSuccess(Contact);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function contactAddSuccess(Contact) {
            contactAddRow(Contact);
            formClear();
        }
        function contactUpdateSuccess(contact) {
            contactUpdateInTable(contact);
        }
        function formClear() {
            $("#fname").val("");
            $("#lName").val("");
            $("#cNum").val("");
        }
        function contactToFields(contact) {
            $("#fname").val(contact.FName);
            $("#lName").val(contact.LName);
            $("#cNum").val(contact.PhoneNumber);
        }
        
        function contactGet(ctl) {
            var id = $(ctl).data("id");
            $("#contactId").val(id);
            $.ajax({
                url: "/api/ContactDetails/" + id,
                type: 'GET',
                dataType: 'json',
                success: function (contact) {
                    contactToFields(contact);
                    $("#updateButton").text("Update");
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }
        function contactUpdateInTable(contact) {
            var row = $("#ContactTable button[data-id='" +
                contact.ID + "']").parents("tr")[0];
            $(row).after(contactBuildTableRow(contact));
            $(row).remove();
            formClear();
            $("#updateButton").text("Add");
        }

    </script>


    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <div class="row">
        <input type="hidden" id="contactId" value="0" />
        <div class="col-sm-6">
            <table id="ContactTable"
                   class="table table-bordered
                 table-condensed table-striped">
                <thead>
                    <tr>
                        <th>Edit</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Cell Number</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <button type="button" id="updateButton"
                    class="btn btn-primary"
                    onclick="addClick();">Add</button>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Contact Information
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label for="fname">First Name</label>
                        <input type="text" id="fname"
                               class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="lName">
                            Last Name
                        </label>
                        <input type="text" id="lName"
                               class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="cNum">Cell Number</label>
                        <input type="text" id="cNum"
                               class="form-control" />
                    </div>
                </div>
                <div class="panel-footer">
                </div>
            </div>
        </div>
    </div>
</body>
</html>